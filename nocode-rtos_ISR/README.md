# RTOS Task Priority and ISR Priority
在CMSIS_OS2（基于CMSIS-RTOS2规范）中，任务优先级与中断服务例程（ISR）优先级的定义及相互关系如下：

### **任务优先级**
1. **优先级范围**  
   任务优先级采用数值递增原则，**数值越大优先级越高**。具体范围由底层RTOS实现决定，例如在RTX5中优先级范围通常为0（最低）到N-1（最高），具体上限需参考目标平台的配置（如部分实现支持0~31级）。

2. **调度规则**  
   高优先级任务会抢占低优先级任务的执行权。若多个任务处于就绪状态，调度器优先选择最高优先级的任务运行。相同优先级的任务按时间片轮转或协作式切换（通过`osThreadYield`主动让出CPU）。

---

### **ISR优先级**
1. **硬件依赖性**  
   ISR优先级由微控制器硬件（如ARM Cortex-M的NVIC）直接管理，与任务优先级体系相互独立。通常硬件中断优先级数值**越小表示优先级越高**（部分平台可能相反，需查阅硬件手册）。

2. **抢占机制**  
   ISR的优先级始终高于所有任务优先级。当ISR触发时，无论当前执行的任务优先级多高，只要ISR的硬件优先级更高，均会立即抢占任务执行。此机制确保实时事件的快速响应。

---

### **任务与ISR优先级关系**
- **优先级层级分离**  
  任务优先级属于RTOS逻辑层，而ISR优先级属于硬件中断控制器层。两者通过以下规则协同工作：
  - ISR可抢占任何任务，但任务无法抢占ISR。
  - ISR中可调用部分RTOS函数（如发送信号、释放信号量），但需注意函数是否支持在中断上下文中调用（部分函数会返回错误码`osErrorISR`）。

- **系统中断配置**  
  内核关键中断（如调度器触发的SysTick、PendSV）通常配置为最低硬件优先级，避免与用户ISR冲突。用户应根据需求为外设ISR分配更高硬件优先级，以实现确定性响应。

---

### **实践建议**
- **任务优先级规划**  
  建议预留部分高优先级等级用于关键任务（如实时控制线程），避免频繁被低优先级任务阻塞。
- **ISR设计原则**  
  ISR应保持短小，仅处理必要操作（如置标志、传递数据指针），复杂逻辑交由任务通过事件驱动方式处理，以减少关中断时间。